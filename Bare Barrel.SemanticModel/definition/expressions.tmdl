expression 'Exhange Rates 2024' = ```
		let
		    Source = Json.Document( Web.Contents(
		                                "https://api.exchangerate.host/timeframe?access_key=bd552d946247b24b39d556976b8073fd&start_date=2024-01-01&end_date=" 
		                                // & DateTime.ToText(DateTime.LocalNow(), "yyyy-MM-dd") & 
		                                & "2024-12-30" &
		                                "&source=USD&currencies=CAD,GBP") 
		)
		
		// Fetches YTD data. Maximum range is 365 days. 
		// Create new table for every new year
		
		
		// Fetches YTD data. Maximum range is 365 days.
		
		
		// Fetches YTD data. Maximum range is 365 days.
		
		
		// Fetches YTD data. Maximum t
		,
		    quotes = Source[quotes],
		    #"Converted to Table" = Record.ToTable(quotes),
		    #"Expanded Value" = Table.ExpandRecordColumn(#"Converted to Table", "Value", {"USDCAD", "USDGBP"}, {"Value.USDCAD", "Value.USDGBP"}),
		    #"Inserted Rounding" = Table.AddColumn(#"Expanded Value", "USDCAD", each Number.Round([Value.USDCAD], 2), type number),
		    #"Inserted Rounding1" = Table.AddColumn(#"Inserted Rounding", "USDGBP", each Number.Round([Value.USDGBP], 2), type number),
		    #"Removed Columns" = Table.RemoveColumns(#"Inserted Rounding1",{"Value.USDCAD", "Value.USDGBP"}),
		    #"Changed Type" = Table.TransformColumnTypes(#"Removed Columns",{{"Name", type date}}),
		    #"Renamed Columns" = Table.RenameColumns(#"Changed Type",{{"Name", "Date"}})
		in
		    #"Renamed Columns"
		```
	lineageTag: bafd2ebc-45e5-4eed-83d0-51120b92846e

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Exception

expression 'Exhange Rates 2023' =
		let
		    Source = Json.Document( Web.Contents("https://api.exchangerate.host/timeframe?access_key=bd552d946247b24b39d556976b8073fd&start_date=2023-01-01&end_date=2023-12-31&source=USD&currencies=CAD,GBP") ),
		    quotes = Source[quotes],
		    #"Converted to Table" = Record.ToTable(quotes),
		    #"Expanded Value" = Table.ExpandRecordColumn(#"Converted to Table", "Value", {"USDCAD", "USDGBP"}, {"Value.USDCAD", "Value.USDGBP"}),
		    #"Inserted Rounding" = Table.AddColumn(#"Expanded Value", "USDCAD", each Number.Round([Value.USDCAD], 2), type number),
		    #"Inserted Rounding1" = Table.AddColumn(#"Inserted Rounding", "USDGBP", each Number.Round([Value.USDGBP], 2), type number),
		    #"Removed Columns" = Table.RemoveColumns(#"Inserted Rounding1",{"Value.USDCAD", "Value.USDGBP"}),
		    #"Changed Type" = Table.TransformColumnTypes(#"Removed Columns",{{"Name", type date}}),
		    #"Renamed Columns" = Table.RenameColumns(#"Changed Type",{{"Name", "Date"}})
		in
		    #"Renamed Columns"
	lineageTag: 44114a76-cad2-4a59-9f4b-264451ed623c

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Table

expression 'Exhange Rates 2022' =
		let
		    Source = Json.Document( Web.Contents("https://api.exchangerate.host/timeframe?access_key=bd552d946247b24b39d556976b8073fd&start_date=2022-01-01&end_date=2022-12-31&source=USD&currencies=CAD,GBP") ),
		    quotes = Source[quotes],
		    #"Converted to Table" = Record.ToTable(quotes),
		    #"Expanded Value" = Table.ExpandRecordColumn(#"Converted to Table", "Value", {"USDCAD", "USDGBP"}, {"Value.USDCAD", "Value.USDGBP"}),
		    #"Inserted Rounding" = Table.AddColumn(#"Expanded Value", "USDCAD", each Number.Round([Value.USDCAD], 2), type number),
		    #"Inserted Rounding1" = Table.AddColumn(#"Inserted Rounding", "USDGBP", each Number.Round([Value.USDGBP], 2), type number),
		    #"Removed Columns" = Table.RemoveColumns(#"Inserted Rounding1",{"Value.USDCAD", "Value.USDGBP"}),
		    #"Changed Type" = Table.TransformColumnTypes(#"Removed Columns",{{"Name", type date}}),
		    #"Renamed Columns" = Table.RenameColumns(#"Changed Type",{{"Name", "Date"}})
		in
		    #"Renamed Columns"
	lineageTag: 9200a9cd-da8a-4eb8-9b77-a3d28e1cefb5

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Table

/// Appends mutliple tables. Base currency is  USD.
/// Maximum date range for each Exchange Rates YYYY table is 365 days. Therefore, new exchange rate table must be created every year. See https://exchangerate.host/documentation
expression 'Exchange Rates' =
		let
		    Source = Table.Combine({#"Exhange Rates 2024", #"Exhange Rates 2023", #"Exhange Rates 2022"}),
		    #"Removed Duplicates" = Table.Distinct(Source, {"Date"}),
		    #"Added Custom" = Table.AddColumn(#"Removed Duplicates", "USDUSD", each 1),
		    #"Reordered Columns" = Table.ReorderColumns(#"Added Custom",{"Date", "USDUSD", "USDCAD", "USDGBP"}),
		    #"Unpivoted Only Selected Columns" = Table.Unpivot(#"Reordered Columns", {"USDUSD", "USDCAD", "USDGBP"}, "Currency Pair", "Exchange Rate"),
		    #"Split Column by Position" = Table.SplitColumn(#"Unpivoted Only Selected Columns", "Currency Pair", Splitter.SplitTextByRepeatedLengths(3), {"Base Currency", "Foreign Currency"}),
		    #"Changed Type" = Table.TransformColumnTypes(#"Split Column by Position",{{"Base Currency", type text}, {"Foreign Currency", type text}}),
		    #"Sorted Rows" = Table.Sort(#"Changed Type",{{"Date", Order.Descending}}),
		    #"Changed Type1" = Table.TransformColumnTypes(#"Sorted Rows",{{"Exchange Rate", type number}})
		in
		    #"Changed Type1"
	lineageTag: cdda6c75-25ed-4909-97e4-86560745ba59

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Exception

expression 'Dim BB Product Codes' =
		let
		    Source = Value.NativeQuery(GoogleBigQuery.Database([Implementation="2.0"]){[Name="modern-sublime-383117"]}[Data], "SELECT DISTINCT sku,#(lf)                asin,#(lf)                product_type,#(lf)                tenant_id#(lf)FROM listings_items.summaries#(lf)WHERE tenant_id = 1#(lf)    AND date = (SELECT MAX(date) #(lf)                    FROM listings_items.summaries#(lf)                    WHERE tenant_id = 1)", null, [EnableFolding=true]),
		    #"Removed Duplicates" = Table.Distinct(Source, {"asin"}),
		    #"Inserted Text Between Delimiters" = Table.AddColumn(#"Removed Duplicates", "Text Between Delimiters", each Text.BetweenDelimiters([sku], "_", "-"), type text),
		    #"Renamed Columns" = Table.RenameColumns(#"Inserted Text Between Delimiters",{{"Text Between Delimiters", "parent_code"}}),
		    #"Inserted Text Between Delimiters1" = Table.AddColumn(#"Renamed Columns", "Text Between Delimiters", each Text.BetweenDelimiters([sku], "-", "-"), type text),
		    #"Renamed Columns1" = Table.RenameColumns(#"Inserted Text Between Delimiters1",{{"Text Between Delimiters", "shaker_code"}}),
		    #"Inserted Merged Column" = Table.AddColumn(#"Renamed Columns1", "parent_shaker_code", each Text.Combine({[parent_code], "-", [shaker_code]}), type text),
		    #"Inserted Text After Delimiter" = Table.AddColumn(#"Inserted Merged Column", "Text After Delimiter", each Text.AfterDelimiter([sku], "SL_"), type text),
		    #"Renamed Columns2" = Table.RenameColumns(#"Inserted Text After Delimiter",{{"Text After Delimiter", "long_product_code"}}),
		    #"Inserted First Characters" = Table.AddColumn(#"Renamed Columns2", "First Characters", each Text.Start([long_product_code], 3), type text),
		    #"Renamed Columns3" = Table.RenameColumns(#"Inserted First Characters",{{"First Characters", "product_code"}}),
		    #"Removed Columns" = Table.RemoveColumns(#"Renamed Columns3",{"long_product_code"}),
		    #"Filtered Rows" = Table.SelectRows(#"Removed Columns", each ([shaker_code] <> ""))
		in
		    #"Filtered Rows"
	lineageTag: 3a43642f-025f-4a5a-8555-6cf9d6255ea4

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Table

expression 'Errors in h10_keyword_tracker' =
		let
		Source = h10_keyword_tracker,
		  #"Detected Type Mismatches" = let
		    tableWithOnlyPrimitiveTypes = Table.SelectColumns(Source, Table.ColumnsOfType(Source, {type nullable number, type nullable text, type nullable logical, type nullable date, type nullable datetime, type nullable datetimezone, type nullable time, type nullable duration})),
		    recordTypeFields = Type.RecordFields(Type.TableRow(Value.Type(tableWithOnlyPrimitiveTypes))),
		    fieldNames = Record.FieldNames(recordTypeFields),
		    fieldTypes = List.Transform(Record.ToList(recordTypeFields), each [Type]),
		    pairs = List.Transform(List.Positions(fieldNames), (i) => {fieldNames{i}, (v) => if v = null or Value.Is(v, fieldTypes{i}) then v else error [Message = "The type of the value does not match the type of the column.", Detail = v], fieldTypes{i}})
		in
		    Table.TransformColumns(Source, pairs),
		  #"Added Index" = Table.AddIndexColumn(#"Detected Type Mismatches", "Row Number" ,1),
		  #"Kept Errors" = Table.SelectRowsWithErrors(#"Added Index", {"asin", "title", "keyword", "tenant_id", "date_added", "organic_rank", "search_volume", "marketplace_id", "sponsored_position", "Date"}),
		  #"Reordered Columns" = Table.ReorderColumns(#"Kept Errors", {"Row Number", "asin", "title", "keyword", "tenant_id", "date_added", "organic_rank", "search_volume", "marketplace_id", "sponsored_position", "Date"})
		in
		  #"Reordered Columns"
	lineageTag: 6cdc609c-c838-483d-8e0d-929551c176bc
	queryGroup: 'Query Errors - 8/16/2025 11:58:07 PM'

	annotation PBI_NavigationStepName = Navigation

	annotation PBI_ResultType = Table

